#' Convert data frame and model \code{\link[stats]{formula}} to input matrix and
#' output vector list
#'
#' Convert a data frame and model \code{\link[stats]{formula}} to a list
#' containing the input variables as a matrix \code{x} and the output variable
#' as a vector \code{y}. These structures are commonly used by various modelling
#' functions such as \code{\link[glmnet]{glmnet}}.
#'
#' All operators made available by \code{\link[stats]{formula}} are allowed.
#'
#' @param data A data frame
#' @param formula A \code{\link[stats]{formula}}
#'
#' @return Two-element list containing input variables as a matrix \code{x}, and
#'   output variable as a vector \code{y}
#'
#' @export
#'
#' @seealso \code{\link[stats]{formula}} \code{\link[stats]{model.matrix}}
#'
#' @examples
#' model_as_xy(mtcars, hp ~ mpg)
#' model_as_xy(mtcars, hp ~ .)
#' model_as_xy(mtcars, hp ~ mpg * hp)
#' model_as_xy(mtcars, ~ .)
model_as_xy <- function(data, formula) {

  if (!is(data, "data.frame") | !is(formula, "formula"))
    stop("Please provide a data frame and formula (see ?stats::formula)")

  # Convert data frame to input matrix and label vector
  x <- stats::model.matrix(object = formula, data = data)[,-1]
  y <- NULL
  if (length(formula) == 3) {
    y <- data[[as.character(formula[[2L]])]]
    y <- y[rownames(data) %in% rownames(x)]  # Handle removal of missing values
  }

  list(x = x, y = y)
}

#' Check for required package
#'
#' Check if package is locally installed and call `stop()` with an error message
#' if not
#'
#' @param pkg_name Character of the package name to check
#'
#' @export
#'
#' @examples
#' check_pkg("stats")
#' check_pkg("dplyr")
#' check_pkg("zzz")
check_pkg <- function(pkg_name) {
  if (!requireNamespace(pkg_name, quietly = TRUE)) {
    stop("The '", pkg_name, "' package is needed. Please install it.", call. = FALSE)
  }
}

#' Pipe operator
#'
#' @name %>%
#' @rdname pipe
#' @keywords internal
#' @export
#' @importFrom magrittr %>%
#' @usage lhs \%>\% rhs
NULL

#' Evaluate a function and list of arguments
#'
#' Evaluate a function and a named list of corresponding arguments
#'
#' @param .f A function
#' @param ... Arguments to pass to functions
#'
#' @export
#'
#' @examples
#' eval_fun(mean, x = c(1, 2, NA, 3), na.rm = TRUE)
eval_fun <- function(.f, ...) {
  eval(lazyeval::call_new(.f, ...))
}
